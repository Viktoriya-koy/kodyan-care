<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat de Apoyo | Kodyan Care</title>
    <link rel="stylesheet" href="/css/style.css?v=5">
    <style>
        .chat-container {
            max-width: 600px;
            margin: 2rem auto;
            background: var(--color-surface);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
        }

        .mensajes {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--color-secondary);
            border-radius: 12px;
            border: 2px solid var(--color-primary-light);
        }

        .mensaje {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 80%;
            line-height: 1.4;
        }

        .mensaje.kody {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }

        .mensaje.usuario {
            background: linear-gradient(135deg, var(--color-text-light), var(--color-text));
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .input-chat {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-chat input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--color-primary);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-chat input:focus {
            outline: none;
            border-color: var(--color-primary-dark);
            box-shadow: 0 0 0 3px rgba(109, 103, 228, 0.1);
        }

        .input-chat button {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border: none;
            padding: 1rem 1.8rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .input-chat button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Typing animation */
        .typing-indicator {
            display: none;
            padding: 0.8rem;
            background: var(--color-secondary);
            border-radius: 12px;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--color-text-light);
            font-style: italic;
        }

        .typing-indicator.active {
            display: block;
        }
    </style>
</head>
<body>
    <header-component></header-component>
    
    <main class="herramienta-detalle">
        <div class="container">
            <h1>üêô Pulpo de Apoyo</h1>
            <p class="subtitulo">Kody est√° aqu√≠ para hacerte compa√±√≠a y guiarte en momentos dif√≠ciles</p>

            <div class="chat-container">
                <div class="mensajes" id="mensajes">
                    <div class="mensaje kody">
                        Hola üíô Soy Kody. ¬øC√≥mo est√°s hoy? Puedo ayudarte con t√©cnicas de grounding o simplemente escucharte.
                    </div>
                </div>

                <div class="typing-indicator" id="typing">
                    Kody est√° escribiendo...
                </div>

                <div class="input-chat">
                    <input type="text" id="input-mensaje" placeholder="Escribe tu mensaje..." onkeypress="handleKeyPress(event)">
                    <button onclick="enviarMensaje()">Enviar</button>
                </div>
            </div>
        </div>
    </main>

    <footer-component></footer-component>
    
    <script type="module" src="/js/script.js"></script>
    <script>
        // Respuestas predefinidas de Kody
        const kodyResponses = [
            "Te entiendo. ¬øQuer√©s que hagamos juntos una t√©cnica de respiraci√≥n?",
            "Gracias por compartirlo. ¬øNecesit√°s ayuda para groundear?",
            "Parece que est√°s pasando por un momento dif√≠cil. ¬øQuer√©s probar una t√©cnica de anclaje?",
            "Estoy aqu√≠ para vos. ¬øTe gustar√≠a hablar de lo que sent√≠s?",
            "Podemos intentar la t√©cnica 5-4-3-2-1 juntos, ¬øte parece?",
            "Respir√° conmigo: inhal√°... mantene... exhal√°... ¬øMejor?",
            "No est√°s solo en esto. ¬øQu√© necesit√°s en este momento?",
            "A veces escribir ayuda. ¬øQuer√©s probar la descarga emocional?"
        ];

        function getRandomResponse() {
            return kodyResponses[Math.floor(Math.random() * kodyResponses.length)];
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                enviarMensaje();
            }
        }

        function enviarMensaje() {
            const input = document.getElementById('input-mensaje');
            const mensajes = document.getElementById('mensajes');
            const typing = document.getElementById('typing');
            
            if (input.value.trim() === '') return;

            // Mensaje del usuario
            const userMsg = document.createElement('div');
            userMsg.className = 'mensaje usuario';
            userMsg.textContent = input.value;
            mensajes.appendChild(userMsg);

            // Limpiar input
            const userMessage = input.value;
            input.value = '';

            // Scroll al final
            mensajes.scrollTop = mensajes.scrollHeight;

            // Mostrar "escribiendo..."
            typing.classList.add('active');
            mensajes.scrollTop = mensajes.scrollHeight;

            // Respuesta de Kody despu√©s de un delay
            setTimeout(() => {
                typing.classList.remove('active');
                
                const kodyMsg = document.createElement('div');
                kodyMsg.className = 'mensaje kody';
                
                // Respuesta inteligente basada en el mensaje del usuario
                let response;
                if (userMessage.toLowerCase().includes('ansiedad') || userMessage.toLowerCase().includes('nervioso')) {
                    response = "Entiendo que sent√≠s ansiedad. ¬øProbamos la respiraci√≥n cuadrada? Inhal√° 4 segundos, manten√© 4, exhal√° 4.";
                } else if (userMessage.toLowerCase().includes('triste') || userMessage.toLowerCase().includes('deprimido')) {
                    response = "Lamento que te sientas as√≠. A veces ayuda nombrar 3 cosas que puedas ver y o√≠r ahora mismo. ¬øProbamos?";
                } else if (userMessage.toLowerCase().includes('soledad')) {
                    response = "Aunque est√©s f√≠sicamente solo, no est√°s solo en esto. Estoy ac√° para acompa√±arte. üíô";
                } else {
                    response = getRandomResponse();
                }
                
                kodyMsg.textContent = response;
                mensajes.appendChild(kodyMsg);
                mensajes.scrollTop = mensajes.scrollHeight;

            }, 2000); // 2 segundos de delay
        }

        // Auto-scroll al cargar
        window.addEventListener('load', () => {
            const mensajes = document.getElementById('mensajes');
            if (mensajes) {
                mensajes.scrollTop = mensajes.scrollHeight;
            }
        });
    </script>
</body>
</html>
